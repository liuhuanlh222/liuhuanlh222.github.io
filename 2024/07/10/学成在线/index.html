<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>学成在线 | Hexo</title><meta name="author" content="HERAO"><meta name="copyright" content="HERAO"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="dev01准备虚拟机，数据库数据、项目分组 准备父工程、base工程 xuecheng-plus-project xuecheng-plus-parent xuecheng-plus-base 导入xuecheng-plus-content-model实体类po 分页  模型类QueryCourseParamsDto（dto） 生成接口文档，进行接口测试 dev02编写课程查询接口以及单元测试 创">
<meta property="og:type" content="article">
<meta property="og:title" content="学成在线">
<meta property="og:url" content="http://example.com/2024/07/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="dev01准备虚拟机，数据库数据、项目分组 准备父工程、base工程 xuecheng-plus-project xuecheng-plus-parent xuecheng-plus-base 导入xuecheng-plus-content-model实体类po 分页  模型类QueryCourseParamsDto（dto） 生成接口文档，进行接口测试 dev02编写课程查询接口以及单元测试 创">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/img/butterfly-icon.png">
<meta property="article:published_time" content="2024-07-10T05:52:24.000Z">
<meta property="article:modified_time" content="2024-09-27T06:56:15.446Z">
<meta property="article:author" content="HERAO">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/butterfly-icon.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "学成在线",
  "url": "http://example.com/2024/07/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF/",
  "image": "http://example.com/img/butterfly-icon.png",
  "datePublished": "2024-07-10T05:52:24.000Z",
  "dateModified": "2024-09-27T06:56:15.446Z",
  "author": [
    {
      "@type": "Person",
      "name": "HERAO",
      "url": "http://example.com/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2024/07/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '学成在线',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.2.0"></head><body><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Hexo</span></a><a class="nav-page-title" href="/"><span class="site-name">学成在线</span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">学成在线</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-07-10T05:52:24.000Z" title="Created 2024-07-10 13:52:24">2024-07-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2024-09-27T06:56:15.446Z" title="Updated 2024-09-27 14:56:15">2024-09-27</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="dev01"><a href="#dev01" class="headerlink" title="dev01"></a>dev01</h1><p>准备虚拟机，数据库数据、项目分组</p>
<p>准备父工程、base工程</p>
<p>xuecheng-plus-project</p>
<p>xuecheng-plus-parent</p>
<p>xuecheng-plus-base</p>
<p>导入xuecheng-plus-content-model实体类po</p>
<p>分页  模型类QueryCourseParamsDto（dto）</p>
<p>生成接口文档，进行接口测试</p>
<h1 id="dev02"><a href="#dev02" class="headerlink" title="dev02"></a>dev02</h1><p><strong>编写课程查询接口以及单元测试</strong></p>
<p>创建数据字典：定义特定的code指定语义（例如：”code”:”202001”对应”desc”:”审核未通过”）</p>
<p>node16版本</p>
<p>导入前端项目并运行。安装系统管理服务在前端讲解内容管理模块的需求时我们提到一个数据字典表，此链接正是在前端请求后端获取数据字典数据的接口地址。数据字典表中配置了项目用的字典信息，此接口是查询字典中的全部数据 ，在此我们不再开发，按照下边的步骤安装系统管理服务即可。（xuecheng-plus-system）</p>
<p>解决跨域问题，从一个地址请求另外一个地址，如果协议、主机、端口三者全部一致则不属于跨域，否则有一个不一致就是跨域请求</p>
<p>解决跨域的方法：</p>
<p>利用script标签的src属性进行跨域请求</p>
<p>服务端在响应头添加Access-Control-Allow-Origin: *</p>
<p>由于服务端之间没有跨域，浏览器通过nginx去访问</p>
<p><strong>课程分类查询</strong>:课程分类树形结构查询</p>
<p><strong>新增课程接口</strong></p>
<p>自定义异常处理</p>
<h1 id="dev03"><a href="#dev03" class="headerlink" title="dev03"></a>dev03</h1><p><strong>JSR303校验</strong></p>
<p><strong>修改课程接口</strong></p>
<p><strong>课程计划查询接口</strong></p>
<p><strong>新增修改课程计划</strong></p>
<h1 id="dev04"><a href="#dev04" class="headerlink" title="dev04"></a>dev04</h1><p><strong>nacos相关配置</strong></p>
<p><strong>配置文件优先级</strong></p>
<p><strong>搭建网关</strong></p>
<p><strong>搭建媒资服务工程</strong></p>
<p><strong>minio文件系统</strong></p>
<p><strong>上传图片</strong> <strong>Service事物优化：代理对象</strong></p>
<h1 id="dev05"><a href="#dev05" class="headerlink" title="dev05"></a>dev05</h1><p><strong>上传视频：</strong>断点续传、分块与合并测试、测试minio合并分块、上传分块、合并分块、合并分块测试</p>
<p><strong>视频处理：</strong>视频转码需求，分布式任务调度，XXL-JOB等</p>
<h1 id="dev06"><a href="#dev06" class="headerlink" title="dev06"></a>dev06</h1><p>视频处理，绑定媒资</p>
<h1 id="dev07"><a href="#dev07" class="headerlink" title="dev07"></a>dev07</h1><p><strong>课程预览</strong></p>
<p><strong>课程发布：</strong>分布式事务，CAP理论，接口开发，消息sdk，课程发布任务调度</p>
<p><strong>CAP理论</strong>：一致性（用户不管访问哪一个结点拿到的数据都是最新的）、可用性（任何时候查询用户信息都可以查询到结果，但不能保证是最新的）、分区容忍性（当系统采用分布式架构时由于网络通信异常导致请求中断、消息丢失，但系统仍然对外提供服务）</p>
<p><strong>BASE理论：</strong>基本可用、软状态、最终一致性</p>
<p>实现CP就是要实现强一致性，实现AP则要保证最终数据一致性</p>
<h1 id="dev08"><a href="#dev08" class="headerlink" title="dev08"></a>dev08</h1><p><strong>课程发布：</strong>页面静态化、熔断降级、页面静态化任务、课程搜索、</p>
<p> <strong>认证授权：</strong>SpringSecurity认证和授权、OAuth2协议详解</p>
<p>页面静态化：课程预览功能通过模板引擎技术在页面模板中填充数据，生成html页面，这个过程是当客户端请求服务器时服务器才开始渲染生成html页面，最后响应给浏览器，服务端渲染的并发能力是有限的</p>
<p>页面静态化则强调将生成html页面的过程提前，提前使用模板引擎技术生成html页面，当客户端请求时直接请求html页面，由于是静态页面可以使用nginx、apache等高性能的web服务器，并发性高</p>
<p><strong>熔断降级：</strong>当下游的服务异常而断开与上游服务的交互，它就相当于保险丝，下游服务异常触发了熔断，从而保证上游服务不受影响。</p>
<p><strong>降级：</strong>当下游服务异常触发熔断后，上游服务就不再去调用异常的微服务而是执行了降级处理逻辑，这个降级处理逻辑可以是本地一个单独的方法</p>
<p>两者都是为了保护系统，熔断是当下游服务异常时一种保护系统的手段，降级是熔断后上游服务处理熔断的方法</p>
<p><strong>全文检索：</strong>计算机索引程序通过扫描文章中的每一个词，对每一个词建立一个索引，指明该词在文章中出现的次数和位置，当用户查询时，检索程序就根据实现建立的索引进行查找，并将查找的结果反馈给用户的检索方式。这个过程类似于通过字典中的检索字表查字的过程</p>
<h1 id="dev09"><a href="#dev09" class="headerlink" title="dev09"></a>dev09</h1><p><strong>认证授权</strong></p>
<p><strong>网关认证</strong>：网关添加依赖、读懂网关的过滤器、要配置白名单、在微服务要放行所有</p>
<p>网关功能：路由转发。认证，校验jwt令牌合法性。维护一份白名单</p>
<p><strong>用户认证</strong></p>
<ol>
<li>连接数据库用户信息，编写UserDetailsService。当查询用户时会访问方法，为NULL表示用户不存在，为UserDetails时开始比对密码，密码错误认证失败，密码正确认证成功（自定义了UserDetailsService）</li>
<li>扩展用户信息。用户表中存储了用户的账号、手机号、email、昵称、qq等信息，UserDetails接口只返回了username、密码等信息。获取工具类，将json字符串转为对象</li>
<li>封装工具类获取用户身份</li>
<li><strong>统一用户认证</strong>（不同的认证方式提交的数据不一样，比如：手机加验证码方式会提交手机号和验证码，账号密码方式会提交账号、密码、验证码。）<ol>
<li>将传入的json转为AuthParamsDto对象</li>
<li>重写DaoAuthenticationProvider的校验的密码的方法，因为我们统一认证入口，有一些认证方式不需要校验密码</li>
<li>对于每一个不同认证的方法都有自己的实现方法，编写不同的类继承AuthService，并实现里面的execute方法。根据认证类型从spring容器取出指定的bean。调用统一的execute方法完成认证</li>
</ol>
</li>
<li>验证码校验：生成key和value储存在redis中，当用户输入验证码时，将验证码和key共同返回给后端，将key对应的value与用户的输入进行比较</li>
<li>远程调用验证码校验</li>
</ol>
<p><strong>微信扫码认证</strong></p>
<p>微信扫码认证，申请令牌，携带令牌查询用户信息、保存用户信息到数据库</p>
<p>微信生成二维码，用户扫码统一授权，重定向到认证服务。请求微信申请令牌，拿到令牌查询用户信息，将用户信息写入本项目数据库。最后走execute方法</p>
<h1 id="dev10"><a href="#dev10" class="headerlink" title="dev10"></a>dev10</h1><p><strong>用户授权：RBAC</strong>：基于角色的访问控制，基于资源的访问控制（扩展性更好）</p>
<p><strong>如何给用户分配权限</strong></p>
<p><strong>细粒度权限：</strong></p>
<p>细粒度授权也叫数据范围授权，即不同的用户所拥有的操作权限相同，但是能够操作的数据范围是不一样的。一个例子：用户A和用户B都是教学机构，他们都拥有“我的课程”权限，但是两个用户所查询到的数据是不一样的。</p>
<p>本项目有哪些细粒度授权？</p>
<p>比如：</p>
<p>我的课程，教学机构只允许查询本教学机构下的课程信息。</p>
<p>我的选课，学生只允许查询自己所选课。</p>
<p>如何实现细粒度授权？</p>
<p>细粒度授权涉及到不同的业务逻辑，通常在service层实现，根据不同的用户进行校验，根据不同的参数查询不同的数据或操作不同的数据。</p>
<p>本项目中如何实现：</p>
<p>教学机构在维护课程时只允许维护本机构的课程，教学机构细粒度授权过程如下：</p>
<p>1）获取当前登录的用户身份</p>
<p>2）得到用户所属教育机构的Id</p>
<p>3）查询该教学机构下的课程信息</p>
<p>最终实现了用户只允许查询自己机构的课程信息。</p>
<p>根据公司Id查询课程，流程如下：</p>
<p>1）教学机构用户登录系统，从用户身份中取出所属机构的id</p>
<p>在用户表中设计了company_id字段存储该用户所属的机构id.</p>
<p>2）接口层取出当前登录用户的身份，取出机构id</p>
<ol start="3">
<li>将机构id传入service方法。</li>
<li>service方法将机构id传入Dao方法，最终查询出本机构的课程信息。</li>
</ol>
<p><strong>选课模块</strong></p>
<p>本模块实现了学生选课、下单支付、学习的整体流程。</p>
<p>网站的课程有免费和收费两种，对于免费课程学生选课后可直接学习，对于收费课程学生需要下单且支付成功方可选课、学习。</p>
<p>选课：是将课程加入我的课程表的过程。</p>
<p>我的课程表：记录我在网站学习的课程，我的课程表中有免费课程和收费课程两种，对于免费课程可直接添加到我的课程表，对于收费课程需要下单、支付成功后自动加入我的课程表。</p>
<p>模块整体流程如下：</p>
<p><img src="/../images/xuanke/1.png" alt="流程"></p>
<p><strong>支付</strong></p>
<h1 id="dev11"><a href="#dev11" class="headerlink" title="dev11"></a>dev11</h1><p><strong>生成支付二维码</strong></p>
<p><strong>支付通知</strong></p>
<h1 id="dev12"><a href="#dev12" class="headerlink" title="dev12"></a>dev12</h1><p><strong>在线学习</strong></p>
<p><strong>我的课程表</strong></p>
<h1 id="dev13"><a href="#dev13" class="headerlink" title="dev13"></a>dev13</h1><p><strong>项目优化</strong></p>
<p><strong>缓存穿透：</strong>大量并发访问一个数据库不存在的数据，由于缓存中没有该数据导致大量并发查询数据库，这个现象叫缓存穿透。造成数据库瞬间压力过大，连接数等资源用完，最终数据库拒绝连接不可用</p>
<ol>
<li>校验请求id号符不符合规则，不复合直接返回</li>
<li>布隆过滤</li>
<li>缓存null或者特殊值</li>
</ol>
<p><strong>缓存雪崩：</strong>缓存雪崩是缓存中大量的key失效后高并发到来时导致大量请求来到数据库，瞬间耗尽数据库资源，导致数据库无法使用</p>
<ol>
<li>使用同步锁，只允许一个线程去查询数据库，查询得到数据后存入缓存</li>
<li>对同一类型的key设置不同的过期时间</li>
<li>缓存预热，不用等到请求到来再去查询数据库存入缓存，可以提前将数据存入缓存。使用缓存预热机制通常有专门的后台程序去将数据库的数据同步到缓存</li>
</ol>
<p><strong>缓存击穿：</strong>缓存击穿是指大量并发访问同一个热点数据，当热点数据失效后同时去请求数据库，瞬间耗尽数据库资源，导致数据库无法使用</p>
<p><strong>分布式锁：</strong>多个虚拟机公用一个锁，虚拟机都去抢占同一个锁，锁是一个单独的程序提供加锁、解锁服务，谁抢到锁谁去查询数据库，该锁已不属于某个虚拟机，而是分布式部署，由多个虚拟机所共享，这种锁叫分布式锁</p>
<p><strong>Redisson实现分布式锁</strong></p>
<p><strong>如何定义一个接口</strong></p>
<ol>
<li>确定协议（GET、POST、PUT、DELETE）</li>
<li>请求，请求参数的格式</li>
<li>响应，返回的响应格式，dto类</li>
<li>生成接口文档</li>
</ol>
<p><strong>跨域问题</strong></p>
<p>跨域是基于浏览器的同源策略，去判断是否跨域请求，同源策略是浏览器的一种安全机制，从一个地址请求另一个地址，如果协议、主机、端口三者相同则不是跨域，否则就是跨域请求</p>
<p><strong>熔断：</strong>当下游服务异常而断开与上游服务的交互，它就相当于保险丝，下游服务异常触发了熔断，从而保证上游服务不受影响</p>
<p><strong>降级：</strong>当下游服务异常触发熔断后，上游服务就不再去调用异常的微服务而是执行了降级处理逻辑，这个降级处理逻辑可以是本地一个单独的方法</p>
<h1 id="项目总结"><a href="#项目总结" class="headerlink" title="项目总结"></a>项目总结</h1><h2 id="内容管理模块"><a href="#内容管理模块" class="headerlink" title="内容管理模块"></a>内容管理模块</h2><p>教学机构的人发布课程，运营人员的人审核课程，课程不审核不能发布（审核状态，发布状态）当流程固定的时候用数据库字段控制，流程变得时候用工作流引擎控制</p>
<p><strong>课程审核：</strong>提交审核，审核，审核通过</p>
<p><strong>课程发布，关于分布式事物控制：</strong>课程信息存储在内容管理数据库，同时课程信息需要向Redis（课程缓存信息），Elasticsearch（课程索引信息），MinIO中更新（课程静态页面），用任务调度做，调度很多微服务</p>
<p><strong>利用xxl-job实现任务调度</strong></p>
<p><strong>使用Freemarker静态化技术将课程页面静态化</strong></p>
<p><strong>使用Elasticsearch对课程发布信息进行索引和搜索</strong></p>
<h2 id="媒资管理模块"><a href="#媒资管理模块" class="headerlink" title="媒资管理模块"></a>媒资管理模块</h2><p><strong>大文件上传</strong>，将文件分块上传的需求满足断点续传</p>
<p><strong>视频处理：</strong>利用多线程处理，<strong>视频上传成功启动视频处理任务</strong>，处理视频运用到CountDownLatch计数器，原始数量8，处理一个减1，设置超时分钟为30分钟，8个视频最多处理30分钟，30分钟一到直接结束任务</p>
<p>在线播放课程视频，课程图片，视频这些都在MinIO文件系统储存，统一由Nginx代理，通过文件服务域名统一访问</p>
<h2 id="认证授权模块"><a href="#认证授权模块" class="headerlink" title="认证授权模块"></a>认证授权模块</h2><p>统一认证入口（登录页面），请求认证服务，认证完成之后给用户下达jwt令牌（jwt令牌中存的是用户信息，呢称，权限，头像等，不包括密码，），之后访问服务，在网关处校验jwt令牌的合法性，合法通过，不合法拦截。之后服务审核有无权限访问接口。jwt令牌存在客户端（cookie等）</p>
<p><strong>OAuth2协议：</strong>先申请授权码，然后申请令牌，最后拿着令牌获取用户信息</p>
<p>xc_user：用户表，储存了系统用户信息，用户类型包括：学生、老师、管理员</p>
<p>xc_role：角色表，储存了系统的角色信息，学生、老师、教学管理员、系统管理员等</p>
<p>xc_user_role：用户角色表，一个用户可以拥有多个角色，一个角色可被多个用户所拥有</p>
<p>xc_menu：模块表，记录了菜单及菜单下的权限</p>
<p>xc_permission：角色权限表</p>
<p><strong>验证码校验：</strong>生成验证码，提交认证携带验证码和key，校验验证码key和输入的验证码（验证码服务根据key从缓存中取出正确的验证码进行比较）</p>
<p><strong>jwt令牌三部分：Header，Payload负载，Signature签名</strong></p>
<p><strong>Spring Security：</strong>自定义UserDetailsService查询用户信息</p>
<h2 id="选课学习"><a href="#选课学习" class="headerlink" title="选课学习"></a>选课学习</h2><p><strong>选课流程：</strong>不收费直接加入课程表学习。收费的话创建商品订单，用户支付成功后加入课程表学习</p>
<p><strong>在线学习：</strong>判断是否有学习资格，没有资格引导购买，有资格直接获取视频学习</p>
<h2 id="订单支付"><a href="#订单支付" class="headerlink" title="订单支付"></a>订单支付</h2><p><strong>支付流程</strong></p>
<p><strong>生成二维码：</strong>点击支付，请求学习中心服务添加选课记录。请求订单服务创建商品订单，生成支付记录，生成二维码，返回二维码</p>
<p><strong>用户扫码支付流程</strong>：用户扫码，请求订单服务下单，订单服务请求支付宝下单，输入密码支付，支付宝通知支付结果，订单服务接受并验签。同时，用户点击查询支付结果发送订单服务，订单服务请求支付宝查询支付结果</p>
<p><strong>支付结果通知</strong></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://example.com">HERAO</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://example.com/2024/07/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF/">http://example.com/2024/07/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/butterfly-icon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2024/04/27/Spring%20cloud%20Alibaba/" title="Spring cloud Alibaba"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Spring cloud Alibaba</div></div><div class="info-2"><div class="info-item-1">Spring Cloud Alibaba 是由阿里巴巴推出的开源项目，源于阿里巴巴在构建大规模分布式系统时的实际需求。它整合了阿里巴巴自己的核心技术和Spring Cloud生态系统，提供了一个完整的微服务解决方案。 微服务介绍系统架构演变单体应用架构——&gt;垂直应用架构——&gt;分布式架构——&gt;SOA架构——&gt;微服务架构。以及悄然兴起的Service...</div></div></div></a><a class="pagination-related" href="/2024/10/13/%E9%BB%91%E9%A9%AC%E7%82%B9%E8%AF%84/" title="黑马点评"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">黑马点评</div></div><div class="info-2"><div class="info-item-1">项目介绍短信登录：Redis的共享session应用 商户查询缓存：  企业的缓存使用技巧 缓存雪崩、穿透等问题解决  优惠卷秒杀：  Redis的计数器、Lua脚本Redis 分布式锁 Redis的三种消息队列  达人探店：  基于List的点赞列表 基于SortedSet的点赞排行榜  好友关注：  基于Set集合的关注、取关、共同关注、消息推送等功能  附近商铺：  Redis的GeoHash的应用  用户签到：  Redis的BitMap数据统计功能  UV统计：  Redis的HyperLogLog的统计功能  短信登录基于session实现登录具体流程如下：  ThreadLocal会将对象保存进入每一个线程内部。实现线程内的资源共享。实现资源对象的线程隔离，保证每个线程各用各的资源，避免因线程征用引发的安全问题 实现发送短信验证码请求方式：POST 请求路径：&#x2F;user&#x2F;code 请求参数：phone，电话号码 返回值：无 12345678910111213141516//代码比较简单@Overridepublic Result...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">HERAO</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#dev01"><span class="toc-number">1.</span> <span class="toc-text">dev01</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dev02"><span class="toc-number">2.</span> <span class="toc-text">dev02</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dev03"><span class="toc-number">3.</span> <span class="toc-text">dev03</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dev04"><span class="toc-number">4.</span> <span class="toc-text">dev04</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dev05"><span class="toc-number">5.</span> <span class="toc-text">dev05</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dev06"><span class="toc-number">6.</span> <span class="toc-text">dev06</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dev07"><span class="toc-number">7.</span> <span class="toc-text">dev07</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dev08"><span class="toc-number">8.</span> <span class="toc-text">dev08</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dev09"><span class="toc-number">9.</span> <span class="toc-text">dev09</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dev10"><span class="toc-number">10.</span> <span class="toc-text">dev10</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dev11"><span class="toc-number">11.</span> <span class="toc-text">dev11</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dev12"><span class="toc-number">12.</span> <span class="toc-text">dev12</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dev13"><span class="toc-number">13.</span> <span class="toc-text">dev13</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93"><span class="toc-number">14.</span> <span class="toc-text">项目总结</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E5%AE%B9%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97"><span class="toc-number">14.1.</span> <span class="toc-text">内容管理模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AA%92%E8%B5%84%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97"><span class="toc-number">14.2.</span> <span class="toc-text">媒资管理模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83%E6%A8%A1%E5%9D%97"><span class="toc-number">14.3.</span> <span class="toc-text">认证授权模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%89%E8%AF%BE%E5%AD%A6%E4%B9%A0"><span class="toc-number">14.4.</span> <span class="toc-text">选课学习</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A2%E5%8D%95%E6%94%AF%E4%BB%98"><span class="toc-number">14.5.</span> <span class="toc-text">订单支付</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/15/Docker%E5%B0%8F%E5%93%88/" title="Docker小哈">Docker小哈</a><time datetime="2025-06-15T01:41:46.000Z" title="Created 2025-06-15 09:41:46">2025-06-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/15/CompletableFuture%E5%AD%A6%E4%B9%A0/" title="CompletableFuture学习">CompletableFuture学习</a><time datetime="2025-05-15T08:46:27.000Z" title="Created 2025-05-15 16:46:27">2025-05-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/02/SpringSecurity/" title="SpringSecurity">SpringSecurity</a><time datetime="2025-05-02T01:12:10.000Z" title="Created 2025-05-02 09:12:10">2025-05-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/28/JWT/" title="JWT">JWT</a><time datetime="2025-04-28T14:43:02.000Z" title="Created 2025-04-28 22:43:02">2025-04-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/18/Java-NIO-Netty/" title="Java NIO Netty">Java NIO Netty</a><time datetime="2025-04-18T03:43:38.000Z" title="Created 2025-04-18 11:43:38">2025-04-18</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By HERAO</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.2.0</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>